<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Initialization</title>
</head>
<body>
    <script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js' async></script>
    <script>
        if (!window.embedded_svc) {
            const s = document.createElement('script');
            s.src = 'https://farmers--uat3.sandbox.my.salesforce-sites.com/embeddedservice/5.0/esw.min.js';
            s.async = true;
            s.addEventListener('load', initESW);
            document.body.appendChild(s);
        } else {
            const dateNum = new Date().getTime();
            const liveAgentURL = 'https://farmers--uat3.sandbox.my.salesforce-sites.com/LiveAgent';
            const cssResourceUrl = `${liveAgentURL}/resource/EmbeddedChat/css/Farmers_EmbeddedChat_Style.css?cacheparam=${dateNum}`;
            const jsResourceUrl = `${liveAgentURL}/resource/EmbeddedChat/scripts/Farmers_EmbeddedChat_Init.js?cacheparam=${dateNum}`;
            const fontResourceUrl1 = `${liveAgentURL}/resource/EmbeddedChat/fontFiles/farmers-web-fonts/OpenSans-Bold.ttf?cacheparam=${dateNum}`;
            const fontResourceUrl2 = `${liveAgentURL}/resource/EmbeddedChat/fontFiles/farmers-web-fonts/OpenSans-SemiBold.ttf?cacheparam=${dateNum}`;
            const fontResourceUrl3 = `${liveAgentURL}/resource/EmbeddedChat/fontFiles/farmers-web-fonts/OpenSans-Regular.ttf?cacheparam=${dateNum}`;
            const loadFontStyle = `${liveAgentURL}/resource/EmbeddedChat/fontFiles/farmers-web-fonts/style.css?cacheparam=${dateNum}`;

            const stylecss = document.createElement('link');
            stylecss.rel = "stylesheet";
            stylecss.href = cssResourceUrl;
            document.head.appendChild(stylecss);

            fetch(jsResourceUrl)
               .then(response => response.text())
               .then(data => {
                    const script = document.createElement('script');
                    script.text = data;
                    document.body.appendChild(script);
                    initESW('https://service.force.com');
                });

            const stylecss1 = document.createElement('link');
            stylecss1.rel = "preload";
            stylecss1.href = fontResourceUrl1;
            stylecss1.as = "font";
            stylecss1.type = "font/ttf";
            stylecss1.crossOrigin = "anonymous";
            document.head.appendChild(stylecss1);

            const stylecss2 = document.createElement('link');
            stylecss2.rel = "preload";
            stylecss2.href = fontResourceUrl2;
            stylecss2.as = "font";
            stylecss2.type = "font/ttf";
            stylecss2.crossOrigin = "anonymous";
            document.head.appendChild(stylecss2);

            const stylecss3 = document.createElement('link');
            stylecss3.rel = "preload";
            stylecss3.href = fontResourceUrl3;
            stylecss3.as = "font";
            stylecss3.type = "font/ttf";
            stylecss3.crossOrigin = "anonymous";
            document.head.appendChild(stylecss3);

            const stylecss4 = document.createElement('link');
            stylecss4.rel = "stylesheet";
            stylecss4.href = loadFontStyle;
            document.head.appendChild(stylecss4);
        }
    </script>
</body>
</html>
